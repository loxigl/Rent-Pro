#!/bin/bash
set -e

# Перейти в корневую директорию проекта
cd "$(dirname "$0")/.."

# Активировать виртуальное окружение, если оно существует
if [ -d "venv" ]; then
    source venv/bin/activate
fi

# Проверить форматирование кода
echo "Проверка форматирования кода..."
black --check src tests

# Проверить линтером
echo "Проверка линтером..."
flake8 src tests

# Проверить сортировку импортов
echo "Проверка сортировки импортов..."
isort --check-only src tests

# Запустить тесты
echo "Запуск тестов..."
pytest -xvs

# Создать отчет о покрытии тестами
echo "Создание отчета о покрытии тестами..."
pytest --cov=src --cov-report=html tests/

echo "Все тесты пройдены успешно!"